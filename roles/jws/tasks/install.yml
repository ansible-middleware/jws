---
- name: Check arguments
  ansible.builtin.assert:
    that:
      - tomcat is defined
      - tomcat.install_method is defined
      - tomcat.install_method in tomcat.supported_install_method
    quiet: true
    fail_msg: "{{ tomcat.install_method }} does not exist or is not supported. Supported methods are: {{ tomcat.supported_install_method }}"

# The following is only for upstream: if jws_version is not defined
# we use the latest version of Apache Tomcat
- name: "Set defaults values (if jws_version is not provided)"
  ansible.builtin.set_fact:
    tomcat_zipfile: "apache-tomcat-{{ tomcat_version }}.zip"
    jws_zipfile_url: "https://archive.apache.org/dist/tomcat/tomcat-{{ tomcat_version.split('.')[0] }}/v{{ tomcat_version }}/bin/{{ tomcat_zipfile }}"
    jws_home: /opt/apache-tomcat-9.0.65/
  when:
    - not jws_version is defined 

- name: "Display install method"
  ansible.builtin.debug:
    msg: "Install method: {{ tomcat.install_method }}"

- name: "Include installation tasks for rhn_zipfiles method"
  ansible.builtin.include_tasks: install/rhn.yml
  when:
    - tomcat.install_method == 'rhn_zipfiles'

- name: "Include installation tasks for zipfiles method"
  ansible.builtin.include_tasks: install/url.yml
  when:
    - tomcat.install_method == 'zipfiles'

- name: "Include installation tasks for local_zipfiles method"
  ansible.builtin.include_tasks: install/local.yml
  when:
    - tomcat.install_method == 'local_zipfiles'

- name: "Include installation tasks for zip operations"
  ansible.builtin.include_tasks: install/zipfiles.yml
  when:
    - tomcat.install_method != 'rpm'

- name: "Include installation tasks for rpm method"
  ansible.builtin.include_tasks: install/rpm.yml
  when:
    - tomcat.install_method == 'rpm'
