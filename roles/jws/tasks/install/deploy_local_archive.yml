---
- name: "Ensure required parameters are provided."
  ansible.builtin.assert:
    that:
      - path_to_zipfile_on_target
      - path_to_zipfile_local
    quiet: True

- name: Check downloaded archive
  ansible.builtin.stat:
    path: "{{ path_to_zipfile_local }}"
  register: local_archive_path
  delegate_to: localhost

- name: Check target download archive path
  ansible.builtin.stat:
    path: "{{ path_to_zipfile_on_target }}"
  register: archive_path

- name: Copy archive to target nodes
  ansible.builtin.copy:
    src: "{{ path_to_zipfile_local }}"
    dest: "{{ path_to_zipfile_on_target }}"
    owner: "{{ jws.user | default(omit) }}"
    group: "{{ jws.group | default(omit) }}"
    mode: 0640
  when:
    - not archive_path.stat.exists
    - local_archive_path.stat is defined
    - local_archive_path.stat.exists
  become: yes
